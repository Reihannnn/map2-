const CACHE_NAME="storymap-cache-v5",OFFLINE_URL="/offline.html",urlsToCache=["/","/index.html","/manifest.json"];self.addEventListener("install",e=>{console.log("âœ… SW installing..."),e.waitUntil(caches.open(CACHE_NAME).then(async e=>{console.log("ğŸ“¦ Caching files");const t=urlsToCache.map(async t=>{try{await e.add(t),console.log(`âœ… Cached: ${t}`)}catch(e){console.warn(`âš ï¸ Failed to cache: ${t}`,e)}});return Promise.all(t)})),self.skipWaiting()}),self.addEventListener("activate",e=>(console.log("ğŸ”„ SW activating..."),e.waitUntil(caches.keys().then(e=>Promise.all(e.map(e=>{if(e!==CACHE_NAME)return console.log("ğŸ—‘ï¸ Deleting old cache:",e),caches.delete(e)})))),self.clients.claim())),self.addEventListener("fetch",e=>{"GET"===e.request.method&&e.request.url.startsWith("http")&&e.respondWith(fetch(e.request).then(t=>{if(!t||200!==t.status||"error"===t.type)return t;const a=t.clone();return caches.open(CACHE_NAME).then(t=>{t.put(e.request,a)}),t}).catch(()=>caches.match(e.request).then(e=>e||caches.match(OFFLINE_URL))))}),self.addEventListener("push",e=>{console.log("ğŸ”” Push notification received!");let t="StoryMap",a="Kamu punya notifikasi baru!";if(e.data)try{const n=e.data.json();t=n.title||t,a=n.options?.body||n.body||a}catch(t){a=e.data.text(),console.log("ğŸ“ Push data (text):",a)}const n={body:a,icon:"/image/android-chrome-192x192.png",badge:"/image/android-chrome-192x192.png"};e.waitUntil(self.registration.showNotification(t,n))});